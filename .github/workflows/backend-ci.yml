# Production Backend CI
#
# PURPOSE: Coordinate production-ready backend workflows with database
# WHY: Real production setup with PostgreSQL integration
# WHEN: Runs on every push/PR to backend code

name: Production Backend CI

# When to run this workflow
on:
  push:
    branches: [ main, develop ]
    paths:
      - 'moneywise-backend/**'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'moneywise-backend/**'

# ENVIRONMENT VARIABLES: Shared across all jobs
env:
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1

jobs:
  # JOB 1: Just build the backend
  build:
    name: üèóÔ∏è Build Backend
    uses: ./.github/workflows/backend-build.yml
    secrets:
      DATABASE_URL: ${{ secrets.DATABASE_URL }}
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
      POSTGRES_HOST: ${{ secrets.POSTGRES_HOST }}
      POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}

  # JOB 2: Simple Summary
  summary:
    name: üìä Summary
    runs-on: ubuntu-latest
    needs: [build]
    if: always()

    steps:
      - name: üìã Show Results
        run: |
          build_result="${{ needs.build.result }}"

          echo "=== Backend CI Results ==="
          echo "Build: $build_result"

          if [ "$build_result" = "success" ]; then
            echo "‚úÖ Backend build completed successfully!"
          else
            echo "‚ùå Backend build failed!"
          fi
